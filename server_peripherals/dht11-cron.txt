#include <WiFi.h>
#include <HTTPClient.h>
#include <DHT.h>

#define DHT_SENSOR_PIN  22
#define DHT_SENSOR_TYPE DHT11
DHT dht_sensor(DHT_SENSOR_PIN, DHT_SENSOR_TYPE);

const char* ssid = "ZgAAAP0OuvgADwEzsarang"; 
const char* password = "18FDF108";           

const char* serverUrl = "http://10.175.107.165:8000/sensor-data/"; 

void setup() {
  Serial.begin(115200);
  dht_sensor.begin();

  WiFi.begin(ssid, password);
  Serial.println("Connecting to WiFi...");
  while (WiFi.status() != WL_CONNECTED) {
    delay(1000);
    Serial.print(".");
  }
  Serial.println("\nConnected to WiFi!");
}

void loop() {
  float humidity = dht_sensor.readHumidity();
  float temperature = dht_sensor.readTemperature();

  if (isnan(humidity) || isnan(temperature)) {
    Serial.println("Failed to read from DHT sensor!");
  } else {
    if (WiFi.status() == WL_CONNECTED) {
      HTTPClient http;
      http.begin(serverUrl);
      http.addHeader("Content-Type", "application/json");

      String payload = "{\"temperature\": " + String(temperature, 2) +
                       ", \"humidity\": " + String(humidity, 2) + "}";

      int httpResponseCode = http.POST(payload);
      Serial.print("HTTP Response: ");
      Serial.println(httpResponseCode);
      
      http.end();
    } else {
      Serial.println("WiFi not connected!");
    }
  }

  delay(5000);
}
